# Get it started

In this chapter we would show basic setup and usage of payum bundle for [symfony2](http://symfony.com/).

Steps:

* [Installation](#installation)
* [Generic configuration](#generic-configuration)
* [Security configuration](#security-configuration)
* [Payment details persistence](#payment-details-persistence)

## Installation

Ultimately, the PayumBundle files should be downloaded to the `vendor/payum` directory.

This can be done in several ways, depending on your preference.
The method described here is the standard method for Symfony 2.1, using [composer](http://getcomposer.org/).
If you prefer use git submodule [read this tutorial](install_as_git_submodules.md) and resume to step 2.

Run composer.phar to download the bundle:

```bash
$ php composer.phar require "payum/payum-bundle:*@stable"

```

_**Note:** You can immediately start using it. The autoloading files have been generated by composer and already included to the app autoload file._

## Generic configuration

Enable the bundle in the kernel:

``` php
<?php
// app/AppKernel.php

public function registerBundles()
{
    $bundles = array(
        // ...
        new Payum\Bundle\PayumBundle\PayumBundle(),
    );
}
```

So now after you registered the bundle you have to import routing and tweak a config.
Let's start from routing and import capture controller.

```yaml
# app/config/routing.yml
payum_capture:
    resource: "@PayumBundle/Resources/config/routing/capture.xml"
```

Set notification controller if you are going to setup instant payment notifications:

```yaml
# app/config/routing.yml
payum_notify:
    resource: "@PayumBundle/Resources/config/routing/notify.xml"
```

## Security configuration

Now the time to configure payment protection.
To do so we have to define a storage for tokens.
The storage has to be able to create\update\find a model that implements `TokenInterface`.
You can use Doctrine ORM\MongoODM or filesystem out of the box.

_**Attention**: Use filesystem storage only for testing and never in production._

### Doctrine ORM token storage.

If you're persisting tokens via the Doctrine ORM, then your `Token` class should live in the Entity namespace of your bundle and look like this to start:

```php
<?php
namespace Acme\PaymentBundle\Entity;

use Doctrine\ORM\Mapping as ORM;
use Payum\Core\Model\Token;

/**
 * @ORM\Table(name="payum_security_token")
 * @ORM\Entity
 */
class PayumSecurityToken extends Token
{
}
```

next, you have to add mapping of the extended token and finally configure token storage:

```yml
#app/config/config.yml

doctrine:
    orm:
        entity_managers:
            default:
                mappings:
                    payum:
                        is_bundle: false
                        type: xml
                        dir: %kernel.root_dir%/../vendor/payum/core/Payum/Core/Bridge/Doctrine/Resources/mapping

                        # set this dir instead if you use `payum/payum` library
                        #dir: %kernel.root_dir%/../vendor/payum/payum/src/Payum/Core/Bridge/Doctrine/Resources/mapping

                        prefix: Payum\Core\Model

payum:
    security:
        token_storage:
            Acme\PaymentBundle\Entity\PayumSecurityToken:
                doctrine:
                    driver: orm
```

### Doctrine MongoODM token storage.

If you're persisting tokens via the Doctrine MongoODM, then your `Token` class should live in the Document namespace of your bundle and look like this to start:

```php
<?php
namespace Acme\PaymentBundle\Document;

use Doctrine\ODM\MongoDB\Mapping\Annotations as Mongo;
use Payum\Core\Model\Token as BaseToken;

/**
 * @Mongo\Document
 */
class PayumSecurityToken extends BaseToken
{
}
```

Token use custom mongo type called `ObjectType`, so you have to add it to the kernel boot method:

```php
<?php
// app\AppKernel.php

use Doctrine\ODM\MongoDB\Types\Type;

class AppKernel extends Kernel
{
    public function boot()
    {
        Type::addType('object', 'Payum\Core\Bridge\Doctrine\Types\ObjectType');

        parent::boot();
    }
```

next, you have to add mapping of the extended token and finally configure token storage:

```yml
#app/config/config.yml

doctrine_mongodb:
    document_managers:
        default:
            auto_mapping: true

            mappings:
                payum:
                    is_bundle: false
                    type: xml
                    dir: %kernel.root_dir%/../vendor/payum/core/Payum/Core/Bridge/Doctrine/Resources/mapping

                    # set this dir instead if you use `payum/payum` library
                    #dir: %kernel.root_dir%/../vendor/payum/payum/src/Payum/Core/Bridge/Doctrine/Resources/mapping

                    prefix: Payum\Core\Model

payum:
    security:
        token_storage:
            Acme\PaymentBundle\Document\PayumSecurityToken:
                doctrine:
                    driver: mongodb
```

### Filesystem token storage.

First you have to extend `Token` model:

```php
<?php
namespace Acme\PaymentBundle\Model;

use Payum\Core\Model\Token;

class PayumSecurityToken extends Token
{
}
```

next, you have to configure token storage to use this model:

```yaml
#app/config/config.yml

payum:
    security:
        token_storage:
            Acme\PaymentBundle\Entity\PayumSecurityToken:
                filesystem:
                    storage_dir: %kernel.root_dir%/Resources/payments
                    id_property: hash
```

## Payment details persistence

Now when you are done with security let's configure a model where you will store all details.
I am gonna show the simplest model you can start with.
Of course you can change it with more sophisticated one.

_**Attention**: Use filesystem storage only for testing and never in production._

### Doctrine ORM persistence.

If you're persisting details via the Doctrine ORM, then your `PaymentDetails` class should live in the Entity namespace of your bundle and look like this to start:

```php
<?php
namespace Acme\PaymentBundle\Entity;

use Doctrine\ORM\Mapping as ORM;

use Payum\Core\Model\ArrayObject;

/**
 * @ORM\Table(name="payum_payment_details")
 * @ORM\Entity
 */
class PaymentDetails extends ArrayObject
{
    /**
     * @ORM\Column(name="id", type="integer")
     * @ORM\Id
     * @ORM\GeneratedValue(strategy="IDENTITY")
     *
     * @var integer $id
     */
    protected $id;
}
```

next, you have to add mapping of the extended token and finally configure token storage:

```yml
#app/config/config.yml

doctrine:
    orm:
        entity_managers:
            default:
                mappings:
                    payum:
                        is_bundle: false
                        type: xml
                        dir: %kernel.root_dir%/../vendor/payum/core/Payum/Core/Bridge/Doctrine/Resources/mapping

                        # set this dir instead if you use `payum/payum` library
                        #dir: %kernel.root_dir%/../vendor/payum/payum/src/Payum/Core/Bridge/Doctrine/Resources/mapping

                        prefix: Payum\Core\Model

payum:
    contexts:
        your_context_here:
            storages:
                Acme\PaymentBundle\Entity\PaymentDetails:
                    doctrine:
                        driver: orm
```

### Doctrine MongoODM persistence.

If you're persisting details via the Doctrine MongoODM, then your `PaymentDetails` class should live in the Document namespace of your bundle and look like this to start:

```php
<?php
namespace Acme\PaymentBundle\Document;

use Doctrine\ODM\MongoDB\Mapping\Annotations as Mongo;
use Payum\Core\Model\ArrayObject;

/**
 * @Mongo\Document
 */
class PaymentDetails extends ArrayObject
{
    /**
     * @Mongo\Id
     *
     * @var integer $id
     */
    protected $id;
}
```

next, you have to add mapping of the extended token and finally configure token storage:

```yml
#app/config/config.yml

doctrine_mongodb:
    document_managers:
        default:
            auto_mapping: true

            mappings:
                payum:
                    is_bundle: false
                    type: xml
                    dir: %kernel.root_dir%/../vendor/payum/core/Payum/Core/Bridge/Doctrine/Resources/mapping

                    # set this dir instead if you use `payum/payum` library
                    #dir: %kernel.root_dir%/../vendor/payum/payum/src/Payum/Core/Bridge/Doctrine/Resources/mapping

                    prefix: Payum\Core\Model

payum:
    contexts:
        your_context_here:
            storages:
                Acme\PaymentBundle\Document\PaymentDetails:
                    doctrine:
                        driver: mongodb
```

## Filesystem persistence.

```php
<?php
namespace Acme\PaymentBundle\Model;

use Payum\Core\Model\ArrayObject;

class PaymentDetails extends ArrayObject
{
    protected $id;
}
```

next, you have to configure token storage to use this model:

```yaml
#app/config/config.yml

payum:
    contexts:
        your_context_here:
            storages:
                Acme\PaymentBundle\Model\PaymentDetails:
                    filesystem:
                        storage_dir: %kernel.root_dir%/Resources/payments
                        id_property: id
```

## Next Step

Now you are ready to configure desired payment.
Check the list of [simple purchase examples](simple_purchase_examples.md) available.
